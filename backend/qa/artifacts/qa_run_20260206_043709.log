[2026-02-06 04:37:09] QA run started
[2026-02-06 04:37:09] BackendRoot=C:\Users\ayomc\Desktop\FLIPTRYBE.inc\Fliptrybe\backend
[2026-02-06 04:37:09] BaseUrl=http://127.0.0.1:5000
[2026-02-06 04:37:09] Running migrations
[2026-02-06 04:37:20] INFO  [alembic.runtime.migration] Context impl SQLiteImpl.
[2026-02-06 04:37:20] INFO  [alembic.runtime.migration] Will assume non-transactional DDL.
[2026-02-06 04:37:26] Server started PID=15656
[2026-02-06 04:38:03] [BOOT] health => PASS (200) GET /api/health
[2026-02-06 04:38:09] [BOOT] seed => PASS (201) POST /api/demo/seed
[2026-02-06 04:38:09] Users: buyer=qa_run_buyer_1750775900@t.com, driver=qa_run_driver_355422046@t.com, merchant=qa_run_merchant_1870100287@t.com, inspector=qa_run_inspector_53472140@t.com
[2026-02-06 04:38:14] [BOOT] register_roles => PASS (201/201/201/201) register buyer/driver/merchant/inspector
[2026-02-06 04:38:16] [BOOT] login_roles => PASS (200/200/200/200) login + token capture
[2026-02-06 04:38:16] [BOOT] admin_approvals => PASS (merchant=200,driver=200) approve role requests
[2026-02-06 04:38:21] orderD=63
[2026-02-06 04:38:22] [REGRESSION] D_pickup_replay => PASS (200/200/200/409) order=63
[2026-02-06 04:38:22] DB SNAP D order=63
[2026-02-06 04:38:23] escrow_unlocks=[77,63,"pickup_seller",0,4,0,1,1,"2026-02-06 12:38:21.900304","2026-02-07 12:38:21.374942"]
[2026-02-06 04:38:23] qr_challenges=[70,63,"pickup_seller","driver","scanned",147,"2026-02-06 12:38:21.464595","2026-02-06 12:38:21.557004","2026-02-06 12:53:21.464603"]
[2026-02-06 04:38:23] orders=[63,"picked_up","2552","8801",0,0,"2026-02-06 12:38:21.900346","HELD",27000.0]
[2026-02-06 04:38:23] [REGRESSION] E_qr_replay => PASS (400) order=63
[2026-02-06 04:38:23] DB SNAP E order=63
[2026-02-06 04:38:23] escrow_unlocks=[77,63,"pickup_seller",0,4,0,1,1,"2026-02-06 12:38:21.900304","2026-02-07 12:38:21.374942"]
[2026-02-06 04:38:23] qr_challenges=[70,63,"pickup_seller","driver","scanned",147,"2026-02-06 12:38:21.464595","2026-02-06 12:38:21.557004","2026-02-06 12:53:21.464603"]
[2026-02-06 04:38:23] orders=[63,"picked_up","2552","8801",0,0,"2026-02-06 12:38:21.900346","HELD",27000.0]
[2026-02-06 04:38:26] [REGRESSION] F_lockout_unlock => PASS (attempts=400,400,400,423; proof=200; admin=200; post=200) order=64
[2026-02-06 04:38:26] DB SNAP F order=64
[2026-02-06 04:38:27] escrow_unlocks=[78,64,"pickup_seller",0,4,0,1,1,"2026-02-06 12:38:25.292072","2026-02-07 12:38:24.448470"]
[2026-02-06 04:38:27] qr_challenges=[71,64,"pickup_seller","driver","scanned",147,"2026-02-06 12:38:24.531334","2026-02-06 12:38:24.589466","2026-02-06 12:53:24.531341"]
[2026-02-06 04:38:27] orders=[64,"picked_up","0233","3609",0,0,"2026-02-06 12:38:25.292108","HELD",27000.0]
[2026-02-06 04:38:29] [REGRESSION] G_cross_role_tamper => PASS (403/403/403/403) order=65
[2026-02-06 04:38:29] DB SNAP G order=65
[2026-02-06 04:38:30] escrow_unlocks=[79,65,"pickup_seller",0,4,0,1,0,"2026-02-07 12:38:29.444981"]
[2026-02-06 04:38:31] qr_challenges=
[2026-02-06 04:38:31] orders=[65,"driver_assigned","7121","4552",0,0,"HELD",27000.0]
[2026-02-06 04:38:36] [REGRESSION] happy_path_delivery => PASS (200/200/200/200/200/200/200/200) order=66, events=paid,created,availability_yes,merchant_accepted,driver_assigned,picked_up,picked_up,escrow_released,delivered,completed
[2026-02-06 04:38:36] timeline_order_66={"items":[{"actor_user_id":145,"created_at":"2026-02-06T12:38:31.720161","event":"paid","id":427,"note":"Order marked paid","order_id":66},{"actor_user_id":145,"created_at":"2026-02-06T12:38:31.737734","event":"created","id":428,"note":"Order created","order_id":66},{"actor_user_id":null,"created_at":"2026-02-06T12:38:32.661939","event":"availability_yes","id":429,"note":"Availability confirmed","order_id":66},{"actor_user_id":147,"created_at":"2026-02-06T12:38:33.068695","event":"merchant_accepted","id":430,"note":"Merchant accepted order","order_id":66},{"actor_user_id":147,"created_at":"2026-02-06T12:38:33.196454","event":"driver_assigned","id":431,"note":"Assigned driver 146","order_id":66},{"actor_user_id":147,"created_at":"2026-02-06T12:38:34.374848","event":"picked_up","id":432,"note":"Pickup confirmed (QR + code)","order_id":66},{"actor_user_id":146,"created_at":"2026-02-06T12:38:34.660183","event":"picked_up","id":433,"note":"Driver set status to picked_up","order_id":66},{"actor_user_id":null,"created_at":"2026-02-06T12:38:35.684806","event":"escrow_released","id":434,"note":"Escrow released","order_id":66},{"actor_user_id":146,"created_at":"2026-02-06T12:38:35.694726","event":"delivered","id":435,"note":"Delivery confirmed (QR + code)","order_id":66},{"actor_user_id":146,"created_at":"2026-02-06T12:38:35.941464","event":"completed","id":436,"note":"Driver set status to completed","order_id":66}],"ok":true}
[2026-02-06 04:38:36] DB SNAP HAPPY order=66
[2026-02-06 04:38:38] escrow_unlocks=[{"value":[80,66,"pickup_seller",0,4,0,1,1,"2026-02-06 12:38:34.335649","2026-02-07 12:38:33.182618",null],"Count":11},{"value":[81,66,"delivery_driver",0,4,0,1,1,"2026-02-06 12:38:35.589526","2026-02-07 12:38:34.643976",null],"Count":11}]
[2026-02-06 04:38:38] qr_challenges=[{"value":[72,66,"pickup_seller","driver","scanned",147,"2026-02-06 12:38:33.329068","2026-02-06 12:38:33.430075","2026-02-06 12:53:33.329074"],"Count":9},{"value":[73,66,"delivery_driver","buyer","scanned",146,"2026-02-06 12:38:34.785264","2026-02-06 12:38:34.927077","2026-02-06 12:53:34.785271"],"Count":9}]
[2026-02-06 04:38:38] orders=[66,"completed","7286","1434",0,0,"2026-02-06 12:38:34.335675","2026-02-06 12:38:35.589561","RELEASED",27000.0,"2026-02-06 12:38:35.677049"]
[2026-02-06 04:38:39] [REGRESSION] ledger_reconcile => PASS (ledger=200/200/200/200, demo=200, recon=200) order_ref=order:66, kinds=order_sale,platform_fee,delivery_fee,delivery_commission
[2026-02-06 04:38:39] reconcile={"fixed":0,"issues":[],"ok":true}
[2026-02-06 04:38:39] Running invariants
[2026-02-06 04:38:40] [INVARIANTS] seller_cannot_buy_own => PASS (409) orders_before=0, orders_after=0, wallet_ref_rows=0
[2026-02-06 04:38:41] [INVARIANTS] follow_rules => PASS (201/403/403) merchant_follow_rows=0, buyer_follow_rows=1
[2026-02-06 04:38:41] [INVARIANTS] chat_rules => PASS (201/201/201/403/403/403/404) support chat/admin gating validated
[2026-02-06 04:38:45] [INVARIANTS] role_switch_control => PASS (set=404,req=201,approve=200,after=200) role_after=driver, request_status=APPROVED
[2026-02-06 04:38:52] [INVARIANTS] idempotency_replay => PASS (create=201/200, mark=200/200, replay=409/409) dup_count=1, tx_before_after=0/0, release_events=1, flow_id=68
[2026-02-06 04:38:52] DB SNAP INV_IDEMPOTENCY order=68
[2026-02-06 04:38:53] escrow_unlocks=[{"value":[82,68,"pickup_seller",0,4,0,1,1,"2026-02-06 12:38:48.624804","2026-02-07 12:38:47.253316",null],"Count":11},{"value":[83,68,"delivery_driver",0,4,0,1,1,"2026-02-06 12:38:51.739633","2026-02-07 12:38:50.257644",null],"Count":11}]
[2026-02-06 04:38:53] qr_challenges=[{"value":[74,68,"pickup_seller","driver","scanned",147,"2026-02-06 12:38:47.362873","2026-02-06 12:38:47.488307","2026-02-06 12:53:47.362881"],"Count":9},{"value":[75,68,"delivery_driver","buyer","scanned",146,"2026-02-06 12:38:50.988318","2026-02-06 12:38:51.074791","2026-02-06 12:53:50.988325"],"Count":9}]
[2026-02-06 04:38:53] orders=[68,"delivered","8277","1262",0,0,"2026-02-06 12:38:48.624845","2026-02-06 12:38:51.739668","RELEASED",27000.0,"2026-02-06 12:38:51.781723"]

=== QA RESULT TABLE ===

Phase      Test                  Result Status                                                   Detail                                                                                                                                  
-----      ----                  ------ ------                                                   ------                                                                                                                                  
BOOT       health                PASS   200                                                      GET /api/health                                                                                                                         
BOOT       seed                  PASS   201                                                      POST /api/demo/seed                                                                                                                     
BOOT       register_roles        PASS   201/201/201/201                                          register buyer/driver/merchant/inspector                                                                                                
BOOT       login_roles           PASS   200/200/200/200                                          login + token capture                                                                                                                   
BOOT       admin_approvals       PASS   merchant=200,driver=200                                  approve role requests                                                                                                                   
REGRESSION D_pickup_replay       PASS   200/200/200/409                                          order=63                                                                                                                                
REGRESSION E_qr_replay           PASS   400                                                      order=63                                                                                                                                
REGRESSION F_lockout_unlock      PASS   attempts=400,400,400,423; proof=200; admin=200; post=200 order=64                                                                                                                                
REGRESSION G_cross_role_tamper   PASS   403/403/403/403                                          order=65                                                                                                                                
REGRESSION happy_path_delivery   PASS   200/200/200/200/200/200/200/200                          order=66, events=paid,created,availability_yes,merchant_accepted,driver_assigned,picked_up,picked_up,escrow_released,delivered,completed
REGRESSION ledger_reconcile      PASS   ledger=200/200/200/200, demo=200, recon=200              order_ref=order:66, kinds=order_sale,platform_fee,delivery_fee,delivery_commission                                                      
INVARIANTS seller_cannot_buy_own PASS   409                                                      orders_before=0, orders_after=0, wallet_ref_rows=0                                                                                      
INVARIANTS follow_rules          PASS   201/403/403                                              merchant_follow_rows=0, buyer_follow_rows=1                                                                                             
INVARIANTS chat_rules            PASS   201/201/201/403/403/403/404                              support chat/admin gating validated                                                                                                     
INVARIANTS role_switch_control   PASS   set=404,req=201,approve=200,after=200                    role_after=driver, request_status=APPROVED                                                                                              
INVARIANTS idempotency_replay    PASS   create=201/200, mark=200/200, replay=409/409             dup_count=1, tx_before_after=0/0, release_events=1, flow_id=68                                                                          



[2026-02-06 04:38:53] TOTAL_FAILS=0
[2026-02-06 04:38:53] Server stopped PID=15656
