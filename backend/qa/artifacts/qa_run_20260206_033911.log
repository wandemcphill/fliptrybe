[2026-02-06 03:39:11] QA run started
[2026-02-06 03:39:11] BackendRoot=C:\Users\ayomc\Desktop\FLIPTRYBE.inc\Fliptrybe\backend
[2026-02-06 03:39:11] BaseUrl=http://127.0.0.1:5000
[2026-02-06 03:39:11] Running migrations
[2026-02-06 03:39:24] INFO  [alembic.runtime.migration] Context impl SQLiteImpl.
[2026-02-06 03:39:24] INFO  [alembic.runtime.migration] Will assume non-transactional DDL.
[2026-02-06 03:39:33] Server started PID=11900
[2026-02-06 03:39:52] [BOOT] health => PASS (200) GET /api/health
[2026-02-06 03:39:58] [BOOT] seed => PASS (201) POST /api/demo/seed
[2026-02-06 03:39:58] Users: buyer=qa_run_buyer_792589853@t.com, driver=qa_run_driver_903985649@t.com, merchant=qa_run_merchant_1433491233@t.com, inspector=qa_run_inspector_712392042@t.com
[2026-02-06 03:40:04] [BOOT] register_roles => PASS (201/201/201/201) register buyer/driver/merchant/inspector
[2026-02-06 03:40:06] [BOOT] login_roles => PASS (200/200/200/200) login + token capture
[2026-02-06 03:40:07] [BOOT] admin_approvals => PASS (merchant=200,driver=200) approve role requests
[2026-02-06 03:40:15] orderD=37
[2026-02-06 03:40:21] [REGRESSION] D_pickup_replay => PASS (200/200/200/409) order=37
[2026-02-06 03:40:21] DB SNAP D order=37
[2026-02-06 03:40:22] escrow_unlocks=[37,37,"pickup_seller",0,4,0,1,1,"2026-02-06 11:40:21.129644","2026-02-07 11:40:10.957323"]
[2026-02-06 03:40:22] qr_challenges=[32,37,"pickup_seller","driver","scanned",73,"2026-02-06 11:40:15.428802","2026-02-06 11:40:19.072901","2026-02-06 11:55:15.428808"]
[2026-02-06 03:40:22] orders=[37,"picked_up","3894","8510",0,0,"2026-02-06 11:40:21.129688","HELD",27000.0]
[2026-02-06 03:40:23] [REGRESSION] E_qr_replay => PASS (400) order=37
[2026-02-06 03:40:23] DB SNAP E order=37
[2026-02-06 03:40:24] escrow_unlocks=[37,37,"pickup_seller",0,4,0,1,1,"2026-02-06 11:40:21.129644","2026-02-07 11:40:10.957323"]
[2026-02-06 03:40:24] qr_challenges=[32,37,"pickup_seller","driver","scanned",73,"2026-02-06 11:40:15.428802","2026-02-06 11:40:19.072901","2026-02-06 11:55:15.428808"]
[2026-02-06 03:40:24] orders=[37,"picked_up","3894","8510",0,0,"2026-02-06 11:40:21.129688","HELD",27000.0]
[2026-02-06 03:40:27] [REGRESSION] F_lockout_unlock => PASS (attempts=400,400,400,423; proof=200; admin=200; post=200) order=38
[2026-02-06 03:40:27] DB SNAP F order=38
[2026-02-06 03:40:30] escrow_unlocks=[38,38,"pickup_seller",0,4,0,1,1,"2026-02-06 11:40:27.396168","2026-02-07 11:40:26.017876"]
[2026-02-06 03:40:30] qr_challenges=[33,38,"pickup_seller","driver","scanned",73,"2026-02-06 11:40:26.250281","2026-02-06 11:40:26.337999","2026-02-06 11:55:26.250289"]
[2026-02-06 03:40:30] orders=[38,"picked_up","1844","5088",0,0,"2026-02-06 11:40:27.396198","HELD",27000.0]
[2026-02-06 03:40:32] [REGRESSION] G_cross_role_tamper => PASS (403/403/403/403) order=39
[2026-02-06 03:40:32] DB SNAP G order=39
[2026-02-06 03:40:33] escrow_unlocks=[39,39,"pickup_seller",0,4,0,1,0,"2026-02-07 11:40:32.194989"]
[2026-02-06 03:40:33] qr_challenges=
[2026-02-06 03:40:33] orders=[39,"driver_assigned","4880","6342",0,0,"HELD",27000.0]
[2026-02-06 03:40:40] [REGRESSION] happy_path_delivery => PASS (200/200/200/200/200/200/200/200) order=40, events=paid,created,availability_yes,merchant_accepted,driver_assigned,picked_up,picked_up,escrow_released,delivered,completed
[2026-02-06 03:40:40] timeline_order_40={"items":[{"actor_user_id":71,"created_at":"2026-02-06T11:40:33.685399","event":"paid","id":216,"note":"Order marked paid","order_id":40},{"actor_user_id":71,"created_at":"2026-02-06T11:40:33.703482","event":"created","id":217,"note":"Order created","order_id":40},{"actor_user_id":null,"created_at":"2026-02-06T11:40:34.235116","event":"availability_yes","id":218,"note":"Availability confirmed","order_id":40},{"actor_user_id":73,"created_at":"2026-02-06T11:40:36.755784","event":"merchant_accepted","id":219,"note":"Merchant accepted order","order_id":40},{"actor_user_id":73,"created_at":"2026-02-06T11:40:36.892474","event":"driver_assigned","id":220,"note":"Assigned driver 72","order_id":40},{"actor_user_id":73,"created_at":"2026-02-06T11:40:37.967274","event":"picked_up","id":221,"note":"Pickup confirmed (QR + code)","order_id":40},{"actor_user_id":72,"created_at":"2026-02-06T11:40:38.169429","event":"picked_up","id":222,"note":"Driver set status to picked_up","order_id":40},{"actor_user_id":null,"created_at":"2026-02-06T11:40:40.552802","event":"escrow_released","id":223,"note":"Escrow released","order_id":40},{"actor_user_id":72,"created_at":"2026-02-06T11:40:40.562319","event":"delivered","id":224,"note":"Delivery confirmed (QR + code)","order_id":40},{"actor_user_id":72,"created_at":"2026-02-06T11:40:40.724936","event":"completed","id":225,"note":"Driver set status to completed","order_id":40}],"ok":true}
[2026-02-06 03:40:40] DB SNAP HAPPY order=40
[2026-02-06 03:40:43] escrow_unlocks=[{"value":[40,40,"pickup_seller",0,4,0,1,1,"2026-02-06 11:40:37.922667","2026-02-07 11:40:36.878517",null],"Count":11},{"value":[41,40,"delivery_driver",0,4,0,1,1,"2026-02-06 11:40:40.472381","2026-02-07 11:40:38.154515",null],"Count":11}]
[2026-02-06 03:40:43] qr_challenges=[{"value":[34,40,"pickup_seller","driver","scanned",73,"2026-02-06 11:40:36.999171","2026-02-06 11:40:37.087777","2026-02-06 11:55:36.999178"],"Count":9},{"value":[35,40,"delivery_driver","buyer","scanned",72,"2026-02-06 11:40:38.250326","2026-02-06 11:40:38.917688","2026-02-06 11:55:38.250332"],"Count":9}]
[2026-02-06 03:40:43] orders=[40,"completed","8995","2106",0,0,"2026-02-06 11:40:37.922694","2026-02-06 11:40:40.472416","RELEASED",27000.0,"2026-02-06 11:40:40.543871"]
[2026-02-06 03:40:45] [REGRESSION] ledger_reconcile => PASS (ledger=200/200/200/200, demo=200, recon=200) order_ref=order:40, kinds=order_sale,platform_fee,delivery_fee,delivery_commission
[2026-02-06 03:40:45] reconcile={"fixed":0,"issues":[],"ok":true}
[2026-02-06 03:40:45] Running invariants
[2026-02-06 03:40:46] [INVARIANTS] seller_cannot_buy_own => PASS (409) orders_before=0, orders_after=0, wallet_ref_rows=0
[2026-02-06 03:40:47] [INVARIANTS] follow_rules => PASS (201/403/403) merchant_follow_rows=0, buyer_follow_rows=1
[2026-02-06 03:40:48] [INVARIANTS] chat_rules => PASS (201/201/201/403/403/403/404) support chat/admin gating validated
[2026-02-06 03:40:53] [INVARIANTS] role_switch_control => PASS (set=404,req=201,approve=200,after=200) role_after=driver, request_status=APPROVED
[2026-02-06 03:41:01] [INVARIANTS] idempotency_replay => PASS (create=201/200, mark=200/200, replay=409/409) dup_count=1, tx_before_after=0/0, release_events=1, flow_id=42
[2026-02-06 03:41:01] DB SNAP INV_IDEMPOTENCY order=42
[2026-02-06 03:41:03] escrow_unlocks=[{"value":[42,42,"pickup_seller",0,4,0,1,1,"2026-02-06 11:40:58.156689","2026-02-07 11:40:56.821430",null],"Count":11},{"value":[43,42,"delivery_driver",0,4,0,1,1,"2026-02-06 11:41:00.976508","2026-02-07 11:40:59.540632",null],"Count":11}]
[2026-02-06 03:41:03] qr_challenges=[{"value":[36,42,"pickup_seller","driver","scanned",73,"2026-02-06 11:40:56.903480","2026-02-06 11:40:56.975666","2026-02-06 11:55:56.903486"],"Count":9},{"value":[37,42,"delivery_driver","buyer","scanned",72,"2026-02-06 11:40:59.805883","2026-02-06 11:41:00.353741","2026-02-06 11:55:59.805891"],"Count":9}]
[2026-02-06 03:41:03] orders=[42,"delivered","9811","3718",0,0,"2026-02-06 11:40:58.156721","2026-02-06 11:41:00.976536","RELEASED",27000.0,"2026-02-06 11:41:01.029189"]

=== QA RESULT TABLE ===

Phase      Test                  Result Status                                                   Detail                                                                                                                                  
-----      ----                  ------ ------                                                   ------                                                                                                                                  
BOOT       health                PASS   200                                                      GET /api/health                                                                                                                         
BOOT       seed                  PASS   201                                                      POST /api/demo/seed                                                                                                                     
BOOT       register_roles        PASS   201/201/201/201                                          register buyer/driver/merchant/inspector                                                                                                
BOOT       login_roles           PASS   200/200/200/200                                          login + token capture                                                                                                                   
BOOT       admin_approvals       PASS   merchant=200,driver=200                                  approve role requests                                                                                                                   
REGRESSION D_pickup_replay       PASS   200/200/200/409                                          order=37                                                                                                                                
REGRESSION E_qr_replay           PASS   400                                                      order=37                                                                                                                                
REGRESSION F_lockout_unlock      PASS   attempts=400,400,400,423; proof=200; admin=200; post=200 order=38                                                                                                                                
REGRESSION G_cross_role_tamper   PASS   403/403/403/403                                          order=39                                                                                                                                
REGRESSION happy_path_delivery   PASS   200/200/200/200/200/200/200/200                          order=40, events=paid,created,availability_yes,merchant_accepted,driver_assigned,picked_up,picked_up,escrow_released,delivered,completed
REGRESSION ledger_reconcile      PASS   ledger=200/200/200/200, demo=200, recon=200              order_ref=order:40, kinds=order_sale,platform_fee,delivery_fee,delivery_commission                                                      
INVARIANTS seller_cannot_buy_own PASS   409                                                      orders_before=0, orders_after=0, wallet_ref_rows=0                                                                                      
INVARIANTS follow_rules          PASS   201/403/403                                              merchant_follow_rows=0, buyer_follow_rows=1                                                                                             
INVARIANTS chat_rules            PASS   201/201/201/403/403/403/404                              support chat/admin gating validated                                                                                                     
INVARIANTS role_switch_control   PASS   set=404,req=201,approve=200,after=200                    role_after=driver, request_status=APPROVED                                                                                              
INVARIANTS idempotency_replay    PASS   create=201/200, mark=200/200, replay=409/409             dup_count=1, tx_before_after=0/0, release_events=1, flow_id=42                                                                          



[2026-02-06 03:41:03] TOTAL_FAILS=0
[2026-02-06 03:41:03] Server stopped PID=11900
