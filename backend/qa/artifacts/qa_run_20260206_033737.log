[2026-02-06 03:37:37] QA run started
[2026-02-06 03:37:37] BackendRoot=C:\Users\ayomc\Desktop\FLIPTRYBE.inc\Fliptrybe\backend
[2026-02-06 03:37:38] BaseUrl=http://127.0.0.1:5000
[2026-02-06 03:37:38] Running migrations
[2026-02-06 03:37:55] INFO  [alembic.runtime.migration] Context impl SQLiteImpl.
[2026-02-06 03:37:55] INFO  [alembic.runtime.migration] Will assume non-transactional DDL.
[2026-02-06 03:38:01] Server started PID=3600
[2026-02-06 03:38:16] [BOOT] health => PASS (200) GET /api/health
[2026-02-06 03:38:19] [BOOT] seed => PASS (201) POST /api/demo/seed
[2026-02-06 03:38:19] Users: buyer=qa_run_buyer_1054631622@t.com, driver=qa_run_driver_1049406459@t.com, merchant=qa_run_merchant_456644867@t.com, inspector=qa_run_inspector_545868048@t.com
[2026-02-06 03:38:25] [BOOT] register_roles => PASS (201/201/201/201) register buyer/driver/merchant/inspector
[2026-02-06 03:38:27] [BOOT] login_roles => PASS (200/200/200/200) login + token capture
[2026-02-06 03:38:28] [BOOT] admin_approvals => PASS (merchant=200,driver=200) approve role requests
[2026-02-06 03:38:31] orderD=31
[2026-02-06 03:38:32] [REGRESSION] D_pickup_replay => PASS (200/200/200/409) order=31
[2026-02-06 03:38:33] DB SNAP D order=31
[2026-02-06 03:38:34] escrow_unlocks=[30,31,"pickup_seller",0,4,0,1,1,"2026-02-06 11:38:31.863815","2026-02-07 11:38:31.087366"]
[2026-02-06 03:38:34] qr_challenges=[26,31,"pickup_seller","driver","scanned",68,"2026-02-06 11:38:31.251031","2026-02-06 11:38:31.329199","2026-02-06 11:53:31.251037"]
[2026-02-06 03:38:34] orders=[31,"picked_up","1821","4465",0,0,"2026-02-06 11:38:31.863854","HELD",27000.0]
[2026-02-06 03:38:34] [REGRESSION] E_qr_replay => PASS (400) order=31
[2026-02-06 03:38:34] DB SNAP E order=31
[2026-02-06 03:38:36] escrow_unlocks=[30,31,"pickup_seller",0,4,0,1,1,"2026-02-06 11:38:31.863815","2026-02-07 11:38:31.087366"]
[2026-02-06 03:38:36] qr_challenges=[26,31,"pickup_seller","driver","scanned",68,"2026-02-06 11:38:31.251031","2026-02-06 11:38:31.329199","2026-02-06 11:53:31.251037"]
[2026-02-06 03:38:36] orders=[31,"picked_up","1821","4465",0,0,"2026-02-06 11:38:31.863854","HELD",27000.0]
[2026-02-06 03:38:39] [REGRESSION] F_lockout_unlock => PASS (attempts=400,400,400,423; proof=200; admin=200; post=200) order=32
[2026-02-06 03:38:39] DB SNAP F order=32
[2026-02-06 03:38:41] escrow_unlocks=[31,32,"pickup_seller",0,4,0,1,1,"2026-02-06 11:38:39.478794","2026-02-07 11:38:37.997096"]
[2026-02-06 03:38:41] qr_challenges=[27,32,"pickup_seller","driver","scanned",68,"2026-02-06 11:38:38.117849","2026-02-06 11:38:38.234029","2026-02-06 11:53:38.117857"]
[2026-02-06 03:38:41] orders=[32,"picked_up","6186","7449",0,0,"2026-02-06 11:38:39.478833","HELD",27000.0]
[2026-02-06 03:38:43] [REGRESSION] G_cross_role_tamper => PASS (403/403/403/403) order=33
[2026-02-06 03:38:43] DB SNAP G order=33
[2026-02-06 03:38:44] escrow_unlocks=[32,33,"pickup_seller",0,4,0,1,0,"2026-02-07 11:38:43.393459"]
[2026-02-06 03:38:44] qr_challenges=
[2026-02-06 03:38:44] orders=[33,"driver_assigned","5818","7681",0,0,"HELD",27000.0]
[2026-02-06 03:38:49] [REGRESSION] happy_path_delivery => PASS (200/200/200/200/200/200/200/200) order=34, events=paid,created,availability_yes,merchant_accepted,driver_assigned,picked_up,picked_up,escrow_released,delivered,completed
[2026-02-06 03:38:49] timeline_order_34={"items":[{"actor_user_id":66,"created_at":"2026-02-06T11:38:44.937218","event":"paid","id":178,"note":"Order marked paid","order_id":34},{"actor_user_id":66,"created_at":"2026-02-06T11:38:44.956346","event":"created","id":179,"note":"Order created","order_id":34},{"actor_user_id":null,"created_at":"2026-02-06T11:38:45.392303","event":"availability_yes","id":180,"note":"Availability confirmed","order_id":34},{"actor_user_id":68,"created_at":"2026-02-06T11:38:45.604626","event":"merchant_accepted","id":181,"note":"Merchant accepted order","order_id":34},{"actor_user_id":68,"created_at":"2026-02-06T11:38:45.688777","event":"driver_assigned","id":182,"note":"Assigned driver 67","order_id":34},{"actor_user_id":68,"created_at":"2026-02-06T11:38:46.977404","event":"picked_up","id":183,"note":"Pickup confirmed (QR + code)","order_id":34},{"actor_user_id":67,"created_at":"2026-02-06T11:38:48.270525","event":"picked_up","id":184,"note":"Driver set status to picked_up","order_id":34},{"actor_user_id":null,"created_at":"2026-02-06T11:38:48.880717","event":"escrow_released","id":185,"note":"Escrow released","order_id":34},{"actor_user_id":67,"created_at":"2026-02-06T11:38:48.890776","event":"delivered","id":186,"note":"Delivery confirmed (QR + code)","order_id":34},{"actor_user_id":67,"created_at":"2026-02-06T11:38:48.955865","event":"completed","id":187,"note":"Driver set status to completed","order_id":34}],"ok":true}
[2026-02-06 03:38:49] DB SNAP HAPPY order=34
[2026-02-06 03:38:50] escrow_unlocks=[{"value":[33,34,"pickup_seller",0,4,0,1,1,"2026-02-06 11:38:46.879203","2026-02-07 11:38:45.670377",null],"Count":11},{"value":[34,34,"delivery_driver",0,4,0,1,1,"2026-02-06 11:38:48.797619","2026-02-07 11:38:48.254872",null],"Count":11}]
[2026-02-06 03:38:50] qr_challenges=[{"value":[28,34,"pickup_seller","driver","scanned",68,"2026-02-06 11:38:45.786405","2026-02-06 11:38:45.839353","2026-02-06 11:53:45.786411"],"Count":9},{"value":[29,34,"delivery_driver","buyer","scanned",67,"2026-02-06 11:38:48.348151","2026-02-06 11:38:48.398177","2026-02-06 11:53:48.348158"],"Count":9}]
[2026-02-06 03:38:50] orders=[34,"completed","1885","3848",0,0,"2026-02-06 11:38:46.879232","2026-02-06 11:38:48.797644","RELEASED",27000.0,"2026-02-06 11:38:48.871478"]
[2026-02-06 03:38:51] [REGRESSION] ledger_reconcile => PASS (ledger=200/200/200/200, demo=200, recon=200) order_ref=order:34, kinds=order_sale,platform_fee,delivery_fee,delivery_commission
[2026-02-06 03:38:51] reconcile={"fixed":0,"issues":[],"ok":true}
[2026-02-06 03:38:52] Running invariants
[2026-02-06 03:38:54] [INVARIANTS] seller_cannot_buy_own => PASS (409) orders_before=0, orders_after=0, wallet_ref_rows=0
[2026-02-06 03:38:54] [INVARIANTS] follow_rules => PASS (201/403/403) merchant_follow_rows=0, buyer_follow_rows=1
[2026-02-06 03:38:55] [INVARIANTS] chat_rules => PASS (201/201/201/403/403/403/404) support chat/admin gating validated
[2026-02-06 03:38:58] [INVARIANTS] role_switch_control => PASS (set=404,req=201,approve=200,after=200) role_after=driver, request_status=APPROVED
[2026-02-06 03:39:09] [INVARIANTS] idempotency_replay => PASS (create=201/200, mark=200/200, replay=409/409) dup_count=1, tx_before_after=0/0, release_events=1, flow_id=36
[2026-02-06 03:39:09] DB SNAP INV_IDEMPOTENCY order=36
[2026-02-06 03:39:11] escrow_unlocks=[{"value":[35,36,"pickup_seller",0,4,0,1,1,"2026-02-06 11:39:06.028766","2026-02-07 11:39:04.914942",null],"Count":11},{"value":[36,36,"delivery_driver",0,4,0,1,1,"2026-02-06 11:39:07.214476","2026-02-07 11:39:06.214787",null],"Count":11}]
[2026-02-06 03:39:11] qr_challenges=[{"value":[30,36,"pickup_seller","driver","scanned",68,"2026-02-06 11:39:05.305184","2026-02-06 11:39:05.459093","2026-02-06 11:54:05.305190"],"Count":9},{"value":[31,36,"delivery_driver","buyer","scanned",67,"2026-02-06 11:39:06.365668","2026-02-06 11:39:06.450782","2026-02-06 11:54:06.365674"],"Count":9}]
[2026-02-06 03:39:11] orders=[36,"delivered","4170","7859",0,0,"2026-02-06 11:39:06.028792","2026-02-06 11:39:07.214510","RELEASED",27000.0,"2026-02-06 11:39:07.257937"]

=== QA RESULT TABLE ===

Phase      Test                  Result Status                                                   Detail                                                                                                                                  
-----      ----                  ------ ------                                                   ------                                                                                                                                  
BOOT       health                PASS   200                                                      GET /api/health                                                                                                                         
BOOT       seed                  PASS   201                                                      POST /api/demo/seed                                                                                                                     
BOOT       register_roles        PASS   201/201/201/201                                          register buyer/driver/merchant/inspector                                                                                                
BOOT       login_roles           PASS   200/200/200/200                                          login + token capture                                                                                                                   
BOOT       admin_approvals       PASS   merchant=200,driver=200                                  approve role requests                                                                                                                   
REGRESSION D_pickup_replay       PASS   200/200/200/409                                          order=31                                                                                                                                
REGRESSION E_qr_replay           PASS   400                                                      order=31                                                                                                                                
REGRESSION F_lockout_unlock      PASS   attempts=400,400,400,423; proof=200; admin=200; post=200 order=32                                                                                                                                
REGRESSION G_cross_role_tamper   PASS   403/403/403/403                                          order=33                                                                                                                                
REGRESSION happy_path_delivery   PASS   200/200/200/200/200/200/200/200                          order=34, events=paid,created,availability_yes,merchant_accepted,driver_assigned,picked_up,picked_up,escrow_released,delivered,completed
REGRESSION ledger_reconcile      PASS   ledger=200/200/200/200, demo=200, recon=200              order_ref=order:34, kinds=order_sale,platform_fee,delivery_fee,delivery_commission                                                      
INVARIANTS seller_cannot_buy_own PASS   409                                                      orders_before=0, orders_after=0, wallet_ref_rows=0                                                                                      
INVARIANTS follow_rules          PASS   201/403/403                                              merchant_follow_rows=0, buyer_follow_rows=1                                                                                             
INVARIANTS chat_rules            PASS   201/201/201/403/403/403/404                              support chat/admin gating validated                                                                                                     
INVARIANTS role_switch_control   PASS   set=404,req=201,approve=200,after=200                    role_after=driver, request_status=APPROVED                                                                                              
INVARIANTS idempotency_replay    PASS   create=201/200, mark=200/200, replay=409/409             dup_count=1, tx_before_after=0/0, release_events=1, flow_id=36                                                                          



[2026-02-06 03:39:11] TOTAL_FAILS=0
[2026-02-06 03:39:11] Server stopped PID=3600
