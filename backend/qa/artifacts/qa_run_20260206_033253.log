[2026-02-06 03:32:53] QA run started
[2026-02-06 03:32:53] BackendRoot=C:\Users\ayomc\Desktop\FLIPTRYBE.inc\Fliptrybe\backend
[2026-02-06 03:32:53] BaseUrl=http://127.0.0.1:5000
[2026-02-06 03:32:53] Running migrations
[2026-02-06 03:33:04] INFO  [alembic.runtime.migration] Context impl SQLiteImpl.
[2026-02-06 03:33:04] INFO  [alembic.runtime.migration] Will assume non-transactional DDL.
[2026-02-06 03:33:10] Server started PID=1708
[2026-02-06 03:33:23] [BOOT] health => PASS (200) GET /api/health
[2026-02-06 03:33:26] [BOOT] seed => PASS (201) POST /api/demo/seed
[2026-02-06 03:33:26] Users: buyer=qa_run_buyer_156248069@t.com, driver=qa_run_driver_76621729@t.com, merchant=qa_run_merchant_1728145139@t.com, inspector=qa_run_inspector_799154808@t.com
[2026-02-06 03:33:29] [BOOT] register_roles => PASS (201/201/201/201) register buyer/driver/merchant/inspector
[2026-02-06 03:33:32] [BOOT] login_roles => PASS (200/200/200/200) login + token capture
[2026-02-06 03:33:32] [BOOT] admin_approvals => PASS (merchant=200,driver=200) approve role requests
[2026-02-06 03:33:35] orderD=25
[2026-02-06 03:33:37] [REGRESSION] D_pickup_replay => PASS (200/200/200/409) order=25
[2026-02-06 03:33:37] DB SNAP D order=25
[2026-02-06 03:33:38] escrow_unlocks=[23,25,"pickup_seller",0,4,0,1,1,"2026-02-06 11:33:36.929873","2026-02-07 11:33:35.504694"]
[2026-02-06 03:33:38] qr_challenges=[20,25,"pickup_seller","driver","scanned",63,"2026-02-06 11:33:35.748525","2026-02-06 11:33:35.928789","2026-02-06 11:48:35.748533"]
[2026-02-06 03:33:38] orders=[25,"picked_up","0703","7073",0,0,"2026-02-06 11:33:36.929908","HELD",27000.0]
[2026-02-06 03:33:38] [REGRESSION] E_qr_replay => PASS (400) order=25
[2026-02-06 03:33:38] DB SNAP E order=25
[2026-02-06 03:33:40] escrow_unlocks=[23,25,"pickup_seller",0,4,0,1,1,"2026-02-06 11:33:36.929873","2026-02-07 11:33:35.504694"]
[2026-02-06 03:33:40] qr_challenges=[20,25,"pickup_seller","driver","scanned",63,"2026-02-06 11:33:35.748525","2026-02-06 11:33:35.928789","2026-02-06 11:48:35.748533"]
[2026-02-06 03:33:40] orders=[25,"picked_up","0703","7073",0,0,"2026-02-06 11:33:36.929908","HELD",27000.0]
[2026-02-06 03:33:43] [REGRESSION] F_lockout_unlock => PASS (attempts=400,400,400,423; proof=200; admin=200; post=200) order=26
[2026-02-06 03:33:43] DB SNAP F order=26
[2026-02-06 03:33:44] escrow_unlocks=[24,26,"pickup_seller",0,4,0,1,1,"2026-02-06 11:33:43.141107","2026-02-07 11:33:41.933326"]
[2026-02-06 03:33:44] qr_challenges=[21,26,"pickup_seller","driver","scanned",63,"2026-02-06 11:33:42.039852","2026-02-06 11:33:42.094324","2026-02-06 11:48:42.039860"]
[2026-02-06 03:33:44] orders=[26,"picked_up","7509","1904",0,0,"2026-02-06 11:33:43.141139","HELD",27000.0]
[2026-02-06 03:33:45] [REGRESSION] G_cross_role_tamper => PASS (403/403/403/403) order=27
[2026-02-06 03:33:45] DB SNAP G order=27
[2026-02-06 03:33:46] escrow_unlocks=[25,27,"pickup_seller",0,4,0,1,0,"2026-02-07 11:33:45.118624"]
[2026-02-06 03:33:46] qr_challenges=
[2026-02-06 03:33:46] orders=[27,"driver_assigned","8923","5291",0,0,"HELD",27000.0]
[2026-02-06 03:33:52] [REGRESSION] happy_path_delivery => PASS (200/200/200/200/200/200/200/200) order=28, events=paid,created,availability_yes,merchant_accepted,driver_assigned,picked_up,picked_up,escrow_released,delivered,completed
[2026-02-06 03:33:52] timeline_order_28={"items":[{"actor_user_id":61,"created_at":"2026-02-06T11:33:46.961754","event":"paid","id":140,"note":"Order marked paid","order_id":28},{"actor_user_id":61,"created_at":"2026-02-06T11:33:47.040132","event":"created","id":141,"note":"Order created","order_id":28},{"actor_user_id":null,"created_at":"2026-02-06T11:33:48.882412","event":"availability_yes","id":142,"note":"Availability confirmed","order_id":28},{"actor_user_id":63,"created_at":"2026-02-06T11:33:49.107527","event":"merchant_accepted","id":143,"note":"Merchant accepted order","order_id":28},{"actor_user_id":63,"created_at":"2026-02-06T11:33:49.229034","event":"driver_assigned","id":144,"note":"Assigned driver 62","order_id":28},{"actor_user_id":63,"created_at":"2026-02-06T11:33:50.076141","event":"picked_up","id":145,"note":"Pickup confirmed (QR + code)","order_id":28},{"actor_user_id":62,"created_at":"2026-02-06T11:33:50.184663","event":"picked_up","id":146,"note":"Driver set status to picked_up","order_id":28},{"actor_user_id":null,"created_at":"2026-02-06T11:33:51.126397","event":"escrow_released","id":147,"note":"Escrow released","order_id":28},{"actor_user_id":62,"created_at":"2026-02-06T11:33:51.223838","event":"delivered","id":148,"note":"Delivery confirmed (QR + code)","order_id":28},{"actor_user_id":62,"created_at":"2026-02-06T11:33:51.589322","event":"completed","id":149,"note":"Driver set status to completed","order_id":28}],"ok":true}
[2026-02-06 03:33:52] DB SNAP HAPPY order=28
[2026-02-06 03:33:53] escrow_unlocks=[{"value":[26,28,"pickup_seller",0,4,0,1,1,"2026-02-06 11:33:50.025543","2026-02-07 11:33:49.212557",null],"Count":11},{"value":[27,28,"delivery_driver",0,4,0,1,1,"2026-02-06 11:33:50.981483","2026-02-07 11:33:50.166406",null],"Count":11}]
[2026-02-06 03:33:53] qr_challenges=[{"value":[22,28,"pickup_seller","driver","scanned",63,"2026-02-06 11:33:49.346240","2026-02-06 11:33:49.411554","2026-02-06 11:48:49.346247"],"Count":9},{"value":[23,28,"delivery_driver","buyer","scanned",62,"2026-02-06 11:33:50.246941","2026-02-06 11:33:50.307057","2026-02-06 11:48:50.246948"],"Count":9}]
[2026-02-06 03:33:53] orders=[28,"completed","8101","1856",0,0,"2026-02-06 11:33:50.025576","2026-02-06 11:33:50.981519","RELEASED",27000.0,"2026-02-06 11:33:51.092256"]
[2026-02-06 03:33:54] [REGRESSION] ledger_reconcile => PASS (ledger=200/200/200/200, demo=200, recon=200) order_ref=order:28, kinds=order_sale,platform_fee,delivery_fee,delivery_commission
[2026-02-06 03:33:54] reconcile={"fixed":0,"issues":[],"ok":true}
[2026-02-06 03:33:54] Running invariants
[2026-02-06 03:33:56] [INVARIANTS] seller_cannot_buy_own => PASS (409) orders_before=0, orders_after=0, wallet_ref_rows=0
[2026-02-06 03:33:57] [INVARIANTS] follow_rules => PASS (201/403/403) merchant_follow_rows=0, buyer_follow_rows=1
[2026-02-06 03:33:58] [INVARIANTS] chat_rules => PASS (201/201/201/403/403/403/404) support chat/admin gating validated
[2026-02-06 03:34:01] [INVARIANTS] role_switch_control => PASS (set=404,req=201,approve=200,after=200) role_after=driver, request_status=APPROVED
[2026-02-06 03:34:09] [INVARIANTS] idempotency_replay => PASS (create=201/200, mark=200/200, replay=409/409) dup_count=1, tx_before_after=0/0, release_events=1, flow_id=30
[2026-02-06 03:34:09] DB SNAP INV_IDEMPOTENCY order=30
[2026-02-06 03:34:10] escrow_unlocks=[{"value":[28,30,"pickup_seller",0,4,0,1,1,"2026-02-06 11:34:05.660681","2026-02-07 11:34:05.090309",null],"Count":11},{"value":[29,30,"delivery_driver",0,4,0,1,1,"2026-02-06 11:34:08.418757","2026-02-07 11:34:05.797221",null],"Count":11}]
[2026-02-06 03:34:10] qr_challenges=[{"value":[24,30,"pickup_seller","driver","scanned",63,"2026-02-06 11:34:05.189763","2026-02-06 11:34:05.256061","2026-02-06 11:49:05.189769"],"Count":9},{"value":[25,30,"delivery_driver","buyer","scanned",62,"2026-02-06 11:34:07.853144","2026-02-06 11:34:07.930471","2026-02-06 11:49:07.853149"],"Count":9}]
[2026-02-06 03:34:10] orders=[30,"delivered","2915","0233",0,0,"2026-02-06 11:34:05.660711","2026-02-06 11:34:08.418790","RELEASED",27000.0,"2026-02-06 11:34:08.462281"]

=== QA RESULT TABLE ===

Phase      Test                  Result Status                                                   Detail                                                                                                                                  
-----      ----                  ------ ------                                                   ------                                                                                                                                  
BOOT       health                PASS   200                                                      GET /api/health                                                                                                                         
BOOT       seed                  PASS   201                                                      POST /api/demo/seed                                                                                                                     
BOOT       register_roles        PASS   201/201/201/201                                          register buyer/driver/merchant/inspector                                                                                                
BOOT       login_roles           PASS   200/200/200/200                                          login + token capture                                                                                                                   
BOOT       admin_approvals       PASS   merchant=200,driver=200                                  approve role requests                                                                                                                   
REGRESSION D_pickup_replay       PASS   200/200/200/409                                          order=25                                                                                                                                
REGRESSION E_qr_replay           PASS   400                                                      order=25                                                                                                                                
REGRESSION F_lockout_unlock      PASS   attempts=400,400,400,423; proof=200; admin=200; post=200 order=26                                                                                                                                
REGRESSION G_cross_role_tamper   PASS   403/403/403/403                                          order=27                                                                                                                                
REGRESSION happy_path_delivery   PASS   200/200/200/200/200/200/200/200                          order=28, events=paid,created,availability_yes,merchant_accepted,driver_assigned,picked_up,picked_up,escrow_released,delivered,completed
REGRESSION ledger_reconcile      PASS   ledger=200/200/200/200, demo=200, recon=200              order_ref=order:28, kinds=order_sale,platform_fee,delivery_fee,delivery_commission                                                      
INVARIANTS seller_cannot_buy_own PASS   409                                                      orders_before=0, orders_after=0, wallet_ref_rows=0                                                                                      
INVARIANTS follow_rules          PASS   201/403/403                                              merchant_follow_rows=0, buyer_follow_rows=1                                                                                             
INVARIANTS chat_rules            PASS   201/201/201/403/403/403/404                              support chat/admin gating validated                                                                                                     
INVARIANTS role_switch_control   PASS   set=404,req=201,approve=200,after=200                    role_after=driver, request_status=APPROVED                                                                                              
INVARIANTS idempotency_replay    PASS   create=201/200, mark=200/200, replay=409/409             dup_count=1, tx_before_after=0/0, release_events=1, flow_id=30                                                                          



[2026-02-06 03:34:10] TOTAL_FAILS=0
[2026-02-06 03:34:10] Server stopped PID=1708
