[2026-02-06 03:31:23] QA run started
[2026-02-06 03:31:23] BackendRoot=C:\Users\ayomc\Desktop\FLIPTRYBE.inc\Fliptrybe\backend
[2026-02-06 03:31:23] BaseUrl=http://127.0.0.1:5000
[2026-02-06 03:31:23] Running migrations
[2026-02-06 03:31:34] INFO  [alembic.runtime.migration] Context impl SQLiteImpl.
[2026-02-06 03:31:35] INFO  [alembic.runtime.migration] Will assume non-transactional DDL.
[2026-02-06 03:31:40] Server started PID=9040
[2026-02-06 03:31:51] [BOOT] health => PASS (200) GET /api/health
[2026-02-06 03:31:53] [BOOT] seed => PASS (201) POST /api/demo/seed
[2026-02-06 03:31:53] Users: buyer=qa_run_buyer_53269957@t.com, driver=qa_run_driver_1391419741@t.com, merchant=qa_run_merchant_9879548@t.com, inspector=qa_run_inspector_1982787269@t.com
[2026-02-06 03:31:58] [BOOT] register_roles => PASS (201/201/201/201) register buyer/driver/merchant/inspector
[2026-02-06 03:32:00] [BOOT] login_roles => PASS (200/200/200/200) login + token capture
[2026-02-06 03:32:01] [BOOT] admin_approvals => PASS (merchant=200,driver=200) approve role requests
[2026-02-06 03:32:04] orderD=19
[2026-02-06 03:32:06] [REGRESSION] D_pickup_replay => PASS (200/200/200/409) order=19
[2026-02-06 03:32:06] DB SNAP D order=19
[2026-02-06 03:32:07] escrow_unlocks=[16,19,"pickup_seller",0,4,0,1,1,"2026-02-06 11:32:05.101478","2026-02-07 11:32:03.923932"]
[2026-02-06 03:32:07] qr_challenges=[14,19,"pickup_seller","driver","scanned",58,"2026-02-06 11:32:04.053408","2026-02-06 11:32:04.116861","2026-02-06 11:47:04.053416"]
[2026-02-06 03:32:07] orders=[19,"picked_up","9788","1490",0,0,"2026-02-06 11:32:05.101514","HELD",27000.0]
[2026-02-06 03:32:07] [REGRESSION] E_qr_replay => PASS (400) order=19
[2026-02-06 03:32:07] DB SNAP E order=19
[2026-02-06 03:32:09] escrow_unlocks=[16,19,"pickup_seller",0,4,0,1,1,"2026-02-06 11:32:05.101478","2026-02-07 11:32:03.923932"]
[2026-02-06 03:32:09] qr_challenges=[14,19,"pickup_seller","driver","scanned",58,"2026-02-06 11:32:04.053408","2026-02-06 11:32:04.116861","2026-02-06 11:47:04.053416"]
[2026-02-06 03:32:09] orders=[19,"picked_up","9788","1490",0,0,"2026-02-06 11:32:05.101514","HELD",27000.0]
[2026-02-06 03:32:11] [REGRESSION] F_lockout_unlock => PASS (attempts=400,400,400,423; proof=200; admin=200; post=200) order=20
[2026-02-06 03:32:11] DB SNAP F order=20
[2026-02-06 03:32:12] escrow_unlocks=[17,20,"pickup_seller",0,4,0,1,1,"2026-02-06 11:32:11.663119","2026-02-07 11:32:10.529551"]
[2026-02-06 03:32:12] qr_challenges=[15,20,"pickup_seller","driver","scanned",58,"2026-02-06 11:32:10.639749","2026-02-06 11:32:10.873527","2026-02-06 11:47:10.639755"]
[2026-02-06 03:32:12] orders=[20,"picked_up","7248","4153",0,0,"2026-02-06 11:32:11.663154","HELD",27000.0]
[2026-02-06 03:32:15] [REGRESSION] G_cross_role_tamper => PASS (403/403/403/403) order=21
[2026-02-06 03:32:15] DB SNAP G order=21
[2026-02-06 03:32:16] escrow_unlocks=[18,21,"pickup_seller",0,4,0,1,0,"2026-02-07 11:32:15.382124"]
[2026-02-06 03:32:16] qr_challenges=
[2026-02-06 03:32:16] orders=[21,"driver_assigned","9072","4384",0,0,"HELD",27000.0]
[2026-02-06 03:32:21] [REGRESSION] happy_path_delivery => PASS (200/200/200/200/200/200/200/200) order=22, events=paid,created,availability_yes,merchant_accepted,driver_assigned,picked_up,picked_up,escrow_released,delivered,completed
[2026-02-06 03:32:21] timeline_order_22={"items":[{"actor_user_id":56,"created_at":"2026-02-06T11:32:16.712167","event":"paid","id":102,"note":"Order marked paid","order_id":22},{"actor_user_id":56,"created_at":"2026-02-06T11:32:16.730622","event":"created","id":103,"note":"Order created","order_id":22},{"actor_user_id":null,"created_at":"2026-02-06T11:32:17.171043","event":"availability_yes","id":104,"note":"Availability confirmed","order_id":22},{"actor_user_id":58,"created_at":"2026-02-06T11:32:17.400904","event":"merchant_accepted","id":105,"note":"Merchant accepted order","order_id":22},{"actor_user_id":58,"created_at":"2026-02-06T11:32:17.473261","event":"driver_assigned","id":106,"note":"Assigned driver 57","order_id":22},{"actor_user_id":58,"created_at":"2026-02-06T11:32:18.770111","event":"picked_up","id":107,"note":"Pickup confirmed (QR + code)","order_id":22},{"actor_user_id":57,"created_at":"2026-02-06T11:32:18.873265","event":"picked_up","id":108,"note":"Driver set status to picked_up","order_id":22},{"actor_user_id":null,"created_at":"2026-02-06T11:32:21.374618","event":"escrow_released","id":109,"note":"Escrow released","order_id":22},{"actor_user_id":57,"created_at":"2026-02-06T11:32:21.395704","event":"delivered","id":110,"note":"Delivery confirmed (QR + code)","order_id":22},{"actor_user_id":57,"created_at":"2026-02-06T11:32:21.488538","event":"completed","id":111,"note":"Driver set status to completed","order_id":22}],"ok":true}
[2026-02-06 03:32:21] DB SNAP HAPPY order=22
[2026-02-06 03:32:22] escrow_unlocks=[{"value":[19,22,"pickup_seller",0,4,0,1,1,"2026-02-06 11:32:18.711691","2026-02-07 11:32:17.459757",null],"Count":11},{"value":[20,22,"delivery_driver",0,4,0,1,1,"2026-02-06 11:32:21.295863","2026-02-07 11:32:18.851063",null],"Count":11}]
[2026-02-06 03:32:22] qr_challenges=[{"value":[16,22,"pickup_seller","driver","scanned",58,"2026-02-06 11:32:17.532985","2026-02-06 11:32:17.978550","2026-02-06 11:47:17.532991"],"Count":9},{"value":[17,22,"delivery_driver","buyer","scanned",57,"2026-02-06 11:32:18.966438","2026-02-06 11:32:19.061209","2026-02-06 11:47:18.966444"],"Count":9}]
[2026-02-06 03:32:22] orders=[22,"completed","3756","5212",0,0,"2026-02-06 11:32:18.711731","2026-02-06 11:32:21.295893","RELEASED",27000.0,"2026-02-06 11:32:21.366209"]
[2026-02-06 03:32:24] [REGRESSION] ledger_reconcile => PASS (ledger=200/200/200/200, demo=200, recon=200) order_ref=order:22, kinds=order_sale,platform_fee,delivery_fee,delivery_commission
[2026-02-06 03:32:24] reconcile={"fixed":0,"issues":[],"ok":true}
[2026-02-06 03:32:24] Running invariants
[2026-02-06 03:32:26] [INVARIANTS] seller_cannot_buy_own => PASS (409) orders_before=0, orders_after=0, wallet_ref_rows=0
[2026-02-06 03:32:27] [INVARIANTS] follow_rules => PASS (201/403/403) merchant_follow_rows=0, buyer_follow_rows=1
[2026-02-06 03:32:28] [INVARIANTS] chat_rules => PASS (201/201/201/403/403/403/404) support chat/admin gating validated
[2026-02-06 03:32:33] [INVARIANTS] role_switch_control => PASS (set=404,req=201,approve=200,after=200) role_after=driver, request_status=APPROVED
[2026-02-06 03:32:40] [INVARIANTS] idempotency_replay => PASS (create=201/200, mark=200/200, replay=409/409) dup_count=1, tx_before_after=0/0, release_events=1, flow_id=24
[2026-02-06 03:32:40] DB SNAP INV_IDEMPOTENCY order=24
[2026-02-06 03:32:41] escrow_unlocks=[{"value":[21,24,"pickup_seller",0,4,0,1,1,"2026-02-06 11:32:37.045141","2026-02-07 11:32:36.434654",null],"Count":11},{"value":[22,24,"delivery_driver",0,4,0,1,1,"2026-02-06 11:32:40.080274","2026-02-07 11:32:37.205944",null],"Count":11}]
[2026-02-06 03:32:41] qr_challenges=[{"value":[18,24,"pickup_seller","driver","scanned",58,"2026-02-06 11:32:36.519924","2026-02-06 11:32:36.581541","2026-02-06 11:47:36.519932"],"Count":9},{"value":[19,24,"delivery_driver","buyer","scanned",57,"2026-02-06 11:32:37.298890","2026-02-06 11:32:37.515051","2026-02-06 11:47:37.298896"],"Count":9}]
[2026-02-06 03:32:41] orders=[24,"delivered","4493","3304",0,0,"2026-02-06 11:32:37.045168","2026-02-06 11:32:40.080308","RELEASED",27000.0,"2026-02-06 11:32:40.124746"]

=== QA RESULT TABLE ===

Phase      Test                  Result Status                                                   Detail                                                                                                                                  
-----      ----                  ------ ------                                                   ------                                                                                                                                  
BOOT       health                PASS   200                                                      GET /api/health                                                                                                                         
BOOT       seed                  PASS   201                                                      POST /api/demo/seed                                                                                                                     
BOOT       register_roles        PASS   201/201/201/201                                          register buyer/driver/merchant/inspector                                                                                                
BOOT       login_roles           PASS   200/200/200/200                                          login + token capture                                                                                                                   
BOOT       admin_approvals       PASS   merchant=200,driver=200                                  approve role requests                                                                                                                   
REGRESSION D_pickup_replay       PASS   200/200/200/409                                          order=19                                                                                                                                
REGRESSION E_qr_replay           PASS   400                                                      order=19                                                                                                                                
REGRESSION F_lockout_unlock      PASS   attempts=400,400,400,423; proof=200; admin=200; post=200 order=20                                                                                                                                
REGRESSION G_cross_role_tamper   PASS   403/403/403/403                                          order=21                                                                                                                                
REGRESSION happy_path_delivery   PASS   200/200/200/200/200/200/200/200                          order=22, events=paid,created,availability_yes,merchant_accepted,driver_assigned,picked_up,picked_up,escrow_released,delivered,completed
REGRESSION ledger_reconcile      PASS   ledger=200/200/200/200, demo=200, recon=200              order_ref=order:22, kinds=order_sale,platform_fee,delivery_fee,delivery_commission                                                      
INVARIANTS seller_cannot_buy_own PASS   409                                                      orders_before=0, orders_after=0, wallet_ref_rows=0                                                                                      
INVARIANTS follow_rules          PASS   201/403/403                                              merchant_follow_rows=0, buyer_follow_rows=1                                                                                             
INVARIANTS chat_rules            PASS   201/201/201/403/403/403/404                              support chat/admin gating validated                                                                                                     
INVARIANTS role_switch_control   PASS   set=404,req=201,approve=200,after=200                    role_after=driver, request_status=APPROVED                                                                                              
INVARIANTS idempotency_replay    PASS   create=201/200, mark=200/200, replay=409/409             dup_count=1, tx_before_after=0/0, release_events=1, flow_id=24                                                                          



[2026-02-06 03:32:41] TOTAL_FAILS=0
[2026-02-06 03:32:41] Server stopped PID=9040
